<head>
    <title>Tim Harrison</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='/static/styles.css' />
    <link rel='stylesheet' href='/static/mobile.css' />
</head>

<div id="header_block">
    <p class="deploy_message">This site has been generated and deployed from Github repository <a
            href="https://github.com/tjtharrison/README.md" target="_blank">tjtharrison/README.md</a></p>
    <div id="header_wrapper">


        <p><img class="me" src="/img/timh.png" /></p>

        <h2>Tim Harrison</h2>
        <h3>DevSecOps Team Lead</h3>

        <ul class="navigation">
            <li><a href="/">Home</a></li>
            <li><a target="_blank" href="https://tjtharrison.medium.com/">medium.com</a></li>
            <li><a href="/pages/guides">Sysadmin Guides</a></li>
            <li><a target="_blank"
                    href="https://www.credly.com/users/tim-harrison.41ce8b8d/badges">Credly <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://github.com/tjtharrison">Github <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://www.linkedin.com/in/tim-harrison-47b11159/"> LinkedIn <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
        </ul>


    </div>
</div>

<div id="body">
    </div></div><h1>Generating an SSH Key Pair for use in Kubernetes Cluster pod</h1>
<p>Below are instructions for creating an SSH key pair from an Ubuntu machine for use on a Kubernetes cluster without having to store the data or key files in plain text in Your Kubernetes configuration.</p>
<p>The first step is to generate Your SSH key pair:</p>
<pre class="highlight"><pre>ssh-keygen -t rsa -b 4096 -m PEM -f [ssh-k8s].key</pre></pre>
<p>You can enter a passphrase if appropriate for Your environment</p>
<p>This will generate a public and private key pair in the directory You are currently in, the public key will have the same name as the private key but with file extension key.pub</p>
<p>The next stage is to create a Kubernetes secret from this key pair, ensure to update the command with the namespace that You wish the key pair to be available in, adjust the filenames and provide an appropriate name for the secret.</p>
<pre class="highlight"><pre>kubectl create secret generic [secret-name] --from-file=ssh-k8s.key --from-file=ssh-k8s.key.pub -n [your-namespace]</pre></pre>
<p>Finally, You should update Your deployment with a volumeMount for the key pair. This is done by adding a volume to the yaml:</p>
<pre class="highlight"><pre>volumes:
  - name: ssh-key
    secret:
      secretName: [secret-name]
      defaultMode: 0600</pre></pre>
<p>Finally update the container spec with a volumeMount for the volume:</p>
<pre class="highlight"><pre>volumeMounts:
  - name: ssh-key
    readOnly: true
    mountPath: '/root/.ssh/'</pre></pre>
<p>Apply the configuration file and Your new ssh key pair will be mounted on Your container in the /root/.ssh/ directory â€“ Note that the filenames will be as follows:</p>
<pre class="highlight"><pre>ssh-privatekey ssh-publickey</pre></pre>
</div>
