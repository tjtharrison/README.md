<head>
    <title>Tim Harrison</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='/static/styles.css' />
    <link rel='stylesheet' href='/static/mobile.css' />
</head>

<div id="header_block">
    <p class="deploy_message">This site has been generated and deployed from Github repository <a
            href="https://github.com/tjtharrison/README.md" target="_blank">tjtharrison/README.md</a></p>
    <div id="header_wrapper">


        <p><img class="me" src="/img/timh.png" /></p>

        <h2>Tim Harrison</h2>
        <h3>DevSecOps Team Lead</h3>

        <ul class="navigation">
            <li><a href="/">Home</a></li>
            <li><a target="_blank" href="https://tjtharrison.medium.com/">medium.com</a></li>
            <li><a href="/pages/guides">Sysadmin Guides</a></li>
            <li><a target="_blank"
                    href="https://www.credly.com/users/tim-harrison.41ce8b8d/badges">Credly <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://github.com/tjtharrison">Github <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://www.linkedin.com/in/tim-harrison-47b11159/"> LinkedIn <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
        </ul>


    </div>
</div>

<div id="body">
    </div></div><h1>Replicating Two Folders using Rsync</h1>
<p>How to set up Rsync to syncronise two folders and schedule this as a repeating task using Cron
In order to syncronise two folders on my ubuntu servers and workstations I use the tool Rsync with the following flags.</p>
<pre class="highlight"><pre>rsync -avu /media/sourcefolder/ /media/destinationfolder/</pre></pre>
<p>These options do the following:</p>
<p>-a = Copy symbolic links as symbolic links rather than the files themselves, while preserving information about the file (creation date etc).</p>
<p>-v = Provide a running status of the copy (Ie you can see the file that is currently being processed).</p>
<p>-u = Update the folder, this is useful when running this job using Cron as it will save each file being copied each time, if it finds that the same file exists in both the source and destination it will not copy this again.</p>
<p>It is important in the above example to note the trailing / at the end of the source directory. This ensures that a folder called ‘sourcefolder’ is not created within your destination. If you leave off this / the end result would be all of your data being copied to the following directory:</p>
<pre class="highlight"><pre>/media/destinationfolder/sourcefolder/</pre></pre>
<p>Once the above has completed, you will have an exact copy of your data from /sourcefolder/ in /destinationfolder/. We can now look to schedule this job to run on an automated schedule using Cron.</p>
<p>Firstly, we will need to make a bash script to run your rsync job as above.</p>
<pre class="highlight"><pre>nano /usr/sbin/[yourjobname]</pre></pre>
<p>Inside this file we will need to put the following</p>
<pre class="highlight"><pre>#!/bin/bash

rsync -avu /media/serverbackups/ /media/serverbackup/</pre></pre>
<p>Once you have saved and closed this file, we will need to make it executable before continuing with automation via cron.</p>
<pre class="highlight"><pre>chmod +x /usr/sbin/[yourscript]</pre></pre>
<p>To edit the Crontab you will need to run the following command:</p>
<pre class="highlight"><pre>crontab -e</pre></pre>
<p>Once inside this file you will need to add a line at the bottom to schedule your sync to run on a schedule. Obviously this is dependent on your requirement, for this example I have set the rsync to occur every 6 hours. I include more information on editing the crontab here.</p>
<pre class="highlight"><pre>0 */6         * * *           /usr/sbin/rsyncjob &gt; /var/log/rsyncjob.log 2&gt;&amp;1</pre></pre>
<p>Once you have saved and closed the crontab your job should now run on a regular basis, outputting to the log file as stated above (/var/log/rsyncjob.log – You can adjust this as required).</p>
</div>
