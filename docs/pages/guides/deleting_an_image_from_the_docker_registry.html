<head>
    <title>Tim Harrison</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='/static/styles.css' />
    <link rel='stylesheet' href='/static/mobile.css' />
</head>

<div id="header_block">
    <p class="deploy_message">This site has been deployed from Github repository <a
            href="https://github.com/tjtharrison/README.md" target="_blank">tjtharrison/README.md</a></p>
    <div id="header_wrapper">


        <p><img class="me" src="/img/timh.png" /></p>

        <h2>Tim Harrison</h2>
        <h3>Infrastructure Team Lead</h3>

        <ul class="navigation">
            <li><a href="/">Home</a></li>
            <li><a href="/pages/runbooks/">Runbooks</a></li>
            <li><a href="/pages/guides">Guides</a></li>
            <li><a target="_blank"
                    href="https://www.credly.com/users/tim-harrison.41ce8b8d/badges">Credly <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://github.com/tjtharrison">Github <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://www.linkedin.com/in/tim-harrison-47b11159/"> LinkedIn <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
        </ul>


    </div>
</div>

<div id="body">
    </div></div><h1>Deleting an image from the Docker Registry</h1>
<p>There is no inbuilt method within the docker provided docker registry so follow the below process to delete images from the registry:</p>
<p>Project repository: <a href="https://github.com/burnettk/delete-docker-registry-image">https://github.com/burnettk/delete-docker-registry-image</a></p>
<h2>Downloading Script:</h2>
<p><code>curl https://raw.githubusercontent.com/burnettk/delete-docker-registry-image/master/delete_docker_registry_image.py | sudo tee /scripts/delete-docker-image.py &gt;/dev/null
sudo chmod a+x /scripts/delete-docker-image.py</code></p>
<h2>Setting up the Script:</h2>
<p>In order to setup the script, you will need to export the environment variable used within the script to specify the Docker registry directory – Adjust this as appropriate for your registry.</p>
<p>Note: This should be set to one level up from the “registry” directory which contains one directory per-docker image on the server.
<code>export REGISTRY_DATA_DIR=/mnt/docker-registry/data/docker/registry/v2/</code></p>
<p>Eg my Docker images are stored within <code>/mnt/docker-registry/data/docker/registry/v2/repositories/</code></p>
<h2>Running the Script:</h2>
<p>Before attempting to delete images you should first stop the Docker container to ensure there are no race conditions (Note this from the Documentation for the Project).</p>
<p><code>sudo docker-compose stop</code></p>
<p>Once the container is stopped, you can run the <code>delete-docker-image.py</code> script with the <code>–dry-run</code> flag to simply print what images and layers will be deleted before removing the flag and running it for real (If you are satisfied with the output).</p>
<p><code>/scripts/delete-docker-image.py --image example-image --dry-run
/scripts/delete-docker-image.py --image example-image</code></p>
<p>Once the files have deleted you can start the registry once more:</p>
<p><code>sudo docker-compose up -d</code></p>
</div>
