<head>
    <title>Tim Harrison</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='/static/styles.css' />
    <link rel='stylesheet' href='/static/mobile.css' />
</head>

<div id="header_block">
    <p class="deploy_message">This site has been generated and deployed from Github repository <a
            href="https://github.com/tjtharrison/README.md" target="_blank">tjtharrison/README.md</a></p>
    <div id="header_wrapper">


        <p><img class="me" src="/img/timh.png" /></p>

        <h2>Tim Harrison</h2>
        <h3>Infrastructure Team Lead</h3>

        <ul class="navigation">
            <li><a href="/">Home</a></li>
            <li><a href="/pages/runbooks/">Runbooks</a></li>
            <li><a href="/pages/guides">Guides</a></li>
            <li><a target="_blank"
                    href="https://www.credly.com/users/tim-harrison.41ce8b8d/badges">Credly <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://github.com/tjtharrison">Github <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
            <li><a target="_blank" href="https://www.linkedin.com/in/tim-harrison-47b11159/"> LinkedIn <i
                        class="fa-solid fa-arrow-up-right-from-square"></i></a></li>
        </ul>


    </div>
</div>

<div id="body">
    </div></div><h1>Set up daily server backups using Mondo</h1>
<p>Mondo can be used to take full backups of your server and store them in ISO format. If Server recovery is required you can restore by booting a new server with ISO attached.
The first stage is to add the Mondo repositories to your Sources.list file used by Apt and install other prerequisits.</p>
<pre class="highlight"><pre>cd /tmp
apt-get instal cifs-utils screen
wget ftp://ftp.mondorescue.org/debian/6/mondorescue.sources.list
cat mondorescue.sources.list &gt;&gt; /etc/apt/sources.list</pre></pre>
<p>We must now edit these sources as they are slightly different using Ubuntu server 12.04 onwards.</p>
<pre class="highlight"><pre>nano /etc/apt/sources.list</pre></pre>
<p>Remove .0 from mondo entries at the bottom
We must now update our server and install Mondo.</p>
<pre class="highlight"><pre>sudo apt-get update
sudo apt-get install mondo</pre></pre>
<p>We will now need to set up a repeating cron job to run your server backups. I have opted to run this daily but this can be added to your cron.hourly, cron.weekly directories as required. The script below will create a new directory inside the folder /media/serverbackups (In this instance this is my mounted network share) with the servername and todayâ€™s date before proceeding to run the server backup. This is a great way of keeping a 7 day retention on your backups. We will then need to make the file executable (Chmod command below).</p>
<pre class="highlight"><pre>nano /etc/cron.daily/mondo
mkdir -p /media/serverbackups/[servername]/`date +%A` &amp;&amp; \
screen -d -m mondoarchive -OiNG -d /media/serverbackups/[servername]/`date +%A` -p [servername] -s 20g
chmod +x /etc/cron.daily/mondo</pre></pre>
<p>We can now try running the file manually to confirm this is going to work (This can take some time depending on the size and performance of your server).</p>
<pre class="highlight"><pre>cd /etc/cron.daily/
./mondo</pre></pre>
</div>
